<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <title>ì˜¤ëŠ˜ì˜ í˜¸êµ¬ : 1ì´ˆ ë‚´ê¸° - Today's Loser</title>

  <!-- Google Fonts: Typography -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Jua&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root {
      --primary-yellow: #FFD700;
      --primary-black: #1a1a1a;
      --primary-white: #FFFFFF;
      --bg-light: #F5F5F5;
      --text-dark: #191F28;
      --text-muted: #6B7684;
    }

    * {
      -webkit-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
      -ms-touch-action: manipulation;
      touch-action: manipulation;
    }

    html, body, #app {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      background: linear-gradient(135deg, #F5F5F5 0%, #EFEFEF 100%);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
      color: var(--text-dark);
      overflow: hidden;
    }

    /* Typography */
    .font-title {
      font-family: 'Black Han Sans', sans-serif;
      font-weight: 900;
      letter-spacing: -0.02em;
    }

    .font-subtitle {
      font-family: 'Jua', cursive;
      font-weight: 400;
      letter-spacing: -0.01em;
    }

    .font-mono {
      font-family: 'Roboto Mono', monospace;
      font-variant-numeric: tabular-nums;
      font-feature-settings: 'tnum';
    }

    /* Card Elevation */
    .card-elevated {
      background: var(--primary-white);
      border-radius: 24px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      transition: box-shadow 0.3s ease, transform 0.3s ease;
    }

    .card-elevated:hover {
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
      transform: translateY(-2px);
    }

    /* Button Styles - 3D Effect */
    .btn-primary {
      background: linear-gradient(135deg, var(--primary-yellow) 0%, #FFC700 100%);
      border: none;
      border-radius: 16px;
      font-weight: 700;
      color: var(--primary-black);
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3), inset 0 -2px 4px rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 215, 0, 0.4), inset 0 -2px 4px rgba(0, 0, 0, 0.1);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(255, 215, 0, 0.2), inset 0 -1px 2px rgba(0, 0, 0, 0.15);
    }

    .btn-secondary {
      background: var(--primary-white);
      border: 2px solid var(--primary-yellow);
      border-radius: 16px;
      font-weight: 700;
      color: var(--primary-black);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-secondary:hover {
      background: rgba(255, 215, 0, 0.1);
      transform: translateY(-2px);
    }

    .btn-secondary:active {
      transform: translateY(0);
    }

    /* Segmented Control */
    .segmented-control {
      display: inline-flex;
      background: rgba(255, 215, 0, 0.1);
      border-radius: 12px;
      padding: 4px;
      gap: 0;
      width: 100%;
    }

    .segmented-control button {
      flex: 1;
      padding: 8px 16px;
      border: none;
      border-radius: 10px;
      background: transparent;
      color: var(--text-muted);
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 13px;
    }

    .segmented-control button.active {
      background: var(--primary-yellow);
      color: var(--primary-black);
      box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
    }

    /* Character Area */
    .character-area {
      width: 120px;
      height: 120px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 80px;
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 215, 0, 0.05) 100%);
      border-radius: 20px;
      border: 2px solid rgba(255, 215, 0, 0.3);
      animation: character-float 3s ease-in-out infinite;
    }

    @keyframes character-float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }

    /* Timer Display */
    .timer-display {
      font-size: clamp(48px, 15vw, 96px);
      line-height: 1;
      text-align: center;
      color: var(--primary-black);
      font-weight: 900;
      letter-spacing: 0.05em;
    }

    /* Shake Effect */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-8px); }
      75% { transform: translateX(8px); }
    }

    .shake {
      animation: shake 0.4s ease-in-out;
    }

    /* Confetti Animation */
    @keyframes confetti-fall {
      to {
        transform: translateY(100vh) rotateZ(360deg);
        opacity: 0;
      }
    }

    .confetti {
      position: fixed;
      pointer-events: none;
      z-index: 1000;
      animation: confetti-fall 2.5s ease-out forwards;
    }

    /* Dark Mode Support */
    @media (prefers-color-scheme: dark) {
      body {
        background: linear-gradient(135deg, #1a1a1a 0%, #242424 100%);
      }

      .card-elevated {
        background: #2a2a2a;
        color: #f5f5f5;
      }

      .timer-display {
        color: var(--primary-yellow);
      }

      .segmented-control {
        background: rgba(255, 215, 0, 0.15);
      }

      .character-area {
        background: linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 215, 0, 0.08) 100%);
      }
    }
  </style>
</head>
<body>
  <div id="app" class="flex flex-col items-center justify-center p-4 sm:p-6">
    <!-- Canvas for confetti -->
    <canvas id="confettiCanvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;"></canvas>

    <div class="w-full max-w-md mx-auto">
      <!-- Header Section -->
      <div class="text-center mb-6 animate-fade-in">
        <h1 class="font-title text-4xl sm:text-5xl mb-2" style="color: var(--primary-black);">
          ì˜¤ëŠ˜ì˜ í˜¸êµ¬
        </h1>
        <p class="font-subtitle text-xl sm:text-2xl" style="color: var(--primary-yellow);">
          1ì´ˆ ë‚´ê¸°
        </p>
        <p class="text-xs sm:text-sm text-gray-500 mt-2" id="modeDesc">ì •í™•íˆ 1ì´ˆë¥¼ ë§ì¶°ë³´ì„¸ìš”</p>
      </div>

      <!-- Main Card -->
      <div class="card-elevated p-6 sm:p-8 mb-6">
        <!-- Best Record -->
        <div class="text-center mb-6 pb-4 border-b border-gray-200">
          <p class="text-xs text-gray-500 mb-1">ìµœê³  ê¸°ë¡</p>
          <p id="bestRecordDisplay" class="text-2xl font-bold" style="color: var(--primary-yellow);">
            ì—†ìŒ
          </p>
          <p id="bestDiffDisplay" class="text-xs text-gray-400 mt-1"></p>
        </div>

        <!-- Mode Selector -->
        <div class="mb-8">
          <p class="text-xs text-gray-500 mb-3 ml-1">ëª¨ë“œ ì„ íƒ</p>
          <div class="segmented-control">
            <button class="mode-btn active" data-mode="1">1.0ì´ˆ</button>
            <button class="mode-btn" data-mode="3">3.0ì´ˆ</button>
            <button class="mode-btn" data-mode="5">5.0ì´ˆ</button>
          </div>
        </div>

        <!-- Character Area -->
        <div class="character-area mb-8" id="characterArea">
          ğŸ¶
        </div>

        <!-- Character Message -->
        <div class="text-center mb-6">
          <p id="characterMessage" class="font-subtitle text-lg sm:text-xl px-4" style="color: var(--primary-black); min-height: 32px;">
            ë„ˆ í˜¸êµ¬ëƒ? 1ì´ˆë„ ëª» ë§ì¶°?
          </p>
        </div>

        <!-- Timer Display -->
        <div class="mb-8 py-6">
          <div class="timer-display font-mono" id="timerDisplay">
            ?.????
          </div>
          <p id="statusMsg" class="text-center text-sm text-gray-500 mt-3">
            ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”
          </p>
        </div>

        <!-- Result Section (hidden by default) -->
        <div id="resultSection" class="hidden mb-8 p-4 rounded-lg" style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3);">
          <p id="resultText" class="text-center font-bold text-lg mb-2"></p>
          <p id="resultSubtext" class="text-center text-xs text-gray-600"></p>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-3 mb-6">
          <button id="actionBtn" class="btn-primary flex-1 px-6 py-4 text-lg font-bold rounded-lg" style="min-height: 56px;">
            ì‹œì‘
          </button>
          <button id="shareBtn" class="btn-secondary flex-1 px-6 py-4 text-lg font-bold rounded-lg" style="min-height: 56px;">
            ê³µìœ í•˜ê¸°
          </button>
        </div>

        <!-- Analytics Placeholder -->
        <div id="toss-ad-banner" class="h-16 flex items-center justify-center border border-dashed border-gray-300 rounded-lg text-xs text-gray-400 bg-gray-50" style="opacity: 0.7;">
          Toss Ads ì˜ì—­
        </div>
      </div>

      <!-- Footer -->
      <footer class="text-center text-xs text-gray-400 mt-6 px-4 leading-relaxed">
        <p>(ì£¼)ì˜ë¡œìš°ë… ì†Œí”„íŠ¸ | ëŒ€í‘œ: ì¡°ì¤€ëª¨</p>
        <p class="mt-1">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸: ë°œê¸‰ì§„í–‰ì¤‘</p>
        <p class="mt-2">ë¬¸ì˜: help@yellowdog.soft</p>
        <p class="mt-3 text-gray-500">Copyright Â© 2026 Yellow Dog Soft. All rights reserved.</p>
      </footer>
    </div>
  </div>

  <script type="module">
    // ============================================================
    // GAME STATE & CONFIGURATION
    // ============================================================
    const STORAGE_KEY = 'today_hogu_best';
    const stateEnum = { IDLE: 'IDLE', RUNNING: 'RUNNING', RESULT: 'RESULT' };

    let appState = stateEnum.IDLE;
    let startTime = 0;
    let rafId = null;
    let targetSeconds = 1.0;
    let lastDuration = null;
    let currentMode = 1;

    // DOM Elements
    const timerDisplay = document.getElementById('timerDisplay');
    const actionBtn = document.getElementById('actionBtn');
    const shareBtn = document.getElementById('shareBtn');
    const statusMsg = document.getElementById('statusMsg');
    const resultSection = document.getElementById('resultSection');
    const resultText = document.getElementById('resultText');
    const resultSubtext = document.getElementById('resultSubtext');
    const bestRecordDisplay = document.getElementById('bestRecordDisplay');
    const bestDiffDisplay = document.getElementById('bestDiffDisplay');
    const characterMessage = document.getElementById('characterMessage');
    const characterArea = document.getElementById('characterArea');
    const modeButtons = document.querySelectorAll('.mode-btn');
    const modeDesc = document.getElementById('modeDesc');
    const confettiCanvas = document.getElementById('confettiCanvas');

    // ============================================================
    // ANALYTICS & LOGGING
    // ============================================================
    function logEvent(eventName, params = {}) {
      console.log(`[Analytics] ${eventName}`, params);
    }

    // ============================================================
    // STORAGE & UI UPDATE
    // ============================================================
    function loadBest() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : null;
      } catch (e) {
        console.error('Failed to load best record:', e);
        return null;
      }
    }

    function saveBest(best) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(best));
      } catch (e) {
        console.error('Failed to save best record:', e);
      }
    }

    function updateBestUI() {
      const best = loadBest();
      if (!best) {
        bestRecordDisplay.textContent = 'ì—†ìŒ';
        bestDiffDisplay.textContent = '';
        return;
      }
      bestRecordDisplay.textContent = `${best.duration.toFixed(4)}ì´ˆ`;
      bestDiffDisplay.textContent = `ì˜¤ì°¨ ${best.diff.toFixed(4)}ì´ˆ`;
    }

    // ============================================================
    // STATE MACHINE
    // ============================================================
    function setState(nextState) {
      appState = nextState;
      renderState();
    }

    function renderState() {
      if (appState === stateEnum.IDLE) {
        actionBtn.textContent = 'ì‹œì‘';
        actionBtn.classList.add('btn-primary');
        actionBtn.classList.remove('btn-secondary');
        timerDisplay.textContent = '?.????';
        statusMsg.textContent = 'ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”';
        resultSection.classList.add('hidden');
        characterMessage.textContent = 'ë„ˆ í˜¸êµ¬ëƒ? 1ì´ˆë„ ëª» ë§ì¶°?';
      } else if (appState === stateEnum.RUNNING) {
        actionBtn.textContent = 'ì •ì§€';
        actionBtn.classList.add('btn-secondary');
        actionBtn.classList.remove('btn-primary');
        timerDisplay.textContent = '?.????';
        statusMsg.textContent = 'ì •í™•í•˜ê²Œ ë©ˆì¶°ë³´ì„¸ìš”!';
        characterMessage.textContent = 'ì•„, ë–¨ë¦¬ë„¤...';
      } else if (appState === stateEnum.RESULT) {
        actionBtn.textContent = 'ë‹¤ì‹œí•˜ê¸°';
        actionBtn.classList.add('btn-primary');
        actionBtn.classList.remove('btn-secondary');
        resultSection.classList.remove('hidden');
      }
    }

    // ============================================================
    // GAME LOGIC
    // ============================================================
    function fmtSec(s) {
      return s.toFixed(4);
    }

    function vibrate(pattern) {
      if (navigator.vibrate) navigator.vibrate(pattern);
    }

    function loop() {
      const now = performance.now();
      const duration = (now - startTime) / 1000;
      lastDuration = duration;
      rafId = requestAnimationFrame(loop);
    }

    function stopAndEvaluate() {
      if (rafId) cancelAnimationFrame(rafId);
      const endTime = performance.now();
      const duration = (endTime - startTime) / 1000;
      lastDuration = duration;
      const rounded = Math.round(duration * 10000) / 10000;
      const diff = Math.abs(rounded - targetSeconds);

      timerDisplay.textContent = fmtSec(rounded) + 'ì´ˆ';

      const perfect = Math.abs(rounded - targetSeconds) === 0;
      const nearMiss = diff <= 0.01 && !perfect;

      vibrate(30);

      if (perfect) {
        vibrate([100, 50, 100]);
        resultText.textContent = `ì™€! ì´ê±¸ ë§ì¶”ë„¤? íƒˆì¶œ!`;
        resultSubtext.textContent = 'ì™„ë²½í•œ íƒ€ì´ë°ì…ë‹ˆë‹¤!';
        characterMessage.textContent = 'ì–´? ì§„ì§œ ë§ì·„ì–´?!';
        launchConfetti();
        playSuccessAnimation();
      } else if (nearMiss) {
        resultText.textContent = `ê±°ì˜ ë‹¤ ì™”ëŠ”ë°... ${fmtSec(rounded)}ì´ˆ`;
        resultSubtext.textContent = `ì˜¤ì°¨ ${diff.toFixed(4)}ì´ˆ - ë‹¤ìŒì—” ì„±ê³µí•  ê±°ì•¼!`;
        characterMessage.textContent = 'ì•„, ì•„ê¹Œì›Œ...';
        playNearMissAnimation();
      } else {
        resultText.textContent = `ì‘~ ë„Œ í‰ìƒ í˜¸êµ¬ì•¼~ (${fmtSec(rounded)}ì´ˆ)`;
        resultSubtext.textContent = `ì˜¤ì°¨ ${diff.toFixed(4)}ì´ˆ`;
        characterMessage.textContent = 'ì‘~ ë„Œ í‰ìƒ í˜¸êµ¬ì•¼~';
        playFailAnimation();
      }

      const prev = loadBest();
      const candidate = {
        duration: rounded,
        diff,
        mode: targetSeconds,
        iso: new Date().toISOString()
      };

      if (!prev || candidate.mode !== prev.mode || candidate.diff < prev.diff) {
        saveBest(candidate);
        if (perfect || nearMiss) {
          vibrate([50, 30, 50, 30, 50]);
        }
      }
      updateBestUI();

      logEvent('game_result', {
        mode: targetSeconds,
        duration: rounded,
        diff,
        is_perfect: perfect,
        is_near_miss: nearMiss
      });

      setState(stateEnum.RESULT);
    }

    // ============================================================
    // ANIMATIONS
    // ============================================================
    function playSuccessAnimation() {
      characterArea.style.animation = 'none';
      setTimeout(() => {
        characterArea.style.animation = 'character-float 3s ease-in-out infinite';
      }, 10);
      characterArea.textContent = 'ğŸ‰';
    }

    function playFailAnimation() {
      const card = document.querySelector('.card-elevated');
      card.classList.add('shake');
      setTimeout(() => card.classList.remove('shake'), 400);
      characterArea.textContent = 'ğŸ˜­';
    }

    function playNearMissAnimation() {
      characterArea.textContent = 'ğŸ˜…';
    }

    function launchConfetti() {
      const canvas = confettiCanvas;
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const particles = [];
      const colors = ['#FFD700', '#FFC700', '#1a1a1a', '#FFFFFF'];

      for (let i = 0; i < 100; i++) {
        particles.push({
          x: Math.random() * canvas.width,
          y: -20,
          vx: (Math.random() - 0.5) * 8,
          vy: Math.random() * 6 + 3,
          size: Math.random() * 8 + 4,
          color: colors[Math.floor(Math.random() * colors.length)],
          rot: Math.random() * 360,
          rotSpeed: (Math.random() - 0.5) * 15
        });
      }

      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (let p of particles) {
          p.x += p.vx;
          p.y += p.vy;
          p.vy += 0.2;
          p.rot += p.rotSpeed;

          ctx.save();
          ctx.translate(p.x, p.y);
          ctx.rotate(p.rot * Math.PI / 180);
          ctx.fillStyle = p.color;
          ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size * 0.6);
          ctx.restore();
        }

        particles = particles.filter(p => p.y < canvas.height + 40);
        if (particles.length > 0) requestAnimationFrame(animate);
        else ctx.clearRect(0, 0, canvas.width, canvas.height);
      }

      requestAnimationFrame(animate);
    }

    // ============================================================
    // EVENT HANDLERS
    // ============================================================
    actionBtn.addEventListener('click', (e) => {
      e.preventDefault();
      actionBtn.disabled = true;
      setTimeout(() => (actionBtn.disabled = false), 300);

      if (appState === stateEnum.IDLE) {
        startTime = performance.now();
        setState(stateEnum.RUNNING);
        vibrate(20);
        logEvent('game_start', { mode: targetSeconds });
        rafId = requestAnimationFrame(loop);
      } else if (appState === stateEnum.RUNNING) {
        stopAndEvaluate();
      } else if (appState === stateEnum.RESULT) {
        setState(stateEnum.IDLE);
      }
    });

    shareBtn.addEventListener('click', async () => {
      vibrate(30);
      const rounded = lastDuration ? Math.round(lastDuration * 10000) / 10000 : null;
      const best = loadBest();

      let shareTitle = 'ì˜¤ëŠ˜ì˜ í˜¸êµ¬ : 1ì´ˆ ë‚´ê¸°';
      let shareText = '';

      if (rounded && appState === stateEnum.RESULT) {
        const diff = Math.abs(rounded - targetSeconds);
        shareText = `ë‚´ ê¸°ë¡: ${rounded.toFixed(4)}ì´ˆ (${targetSeconds}ì´ˆ ëª¨ë“œ)\n`;
        shareText += `ì˜¤ì°¨: ${diff.toFixed(4)}ì´ˆ\n\n`;
        if (best && best.mode === targetSeconds) {
          shareText += `ìµœê³  ê¸°ë¡: ${best.duration.toFixed(4)}ì´ˆ\n`;
        }
        shareText += `ë„ˆë„ ë„ì „í•´ë´! 1ì´ˆë¥¼ ë§ì¶œ ìˆ˜ ìˆë‚˜?`;
      } else {
        shareText = `ì •í™•íˆ ${targetSeconds}ì´ˆì— íƒ€ì´ë¨¸ë¥¼ ë©ˆì¶°ë³´ì„¸ìš”!\n\në„ˆëŠ” í˜¸êµ¬? ì²œì¬? í•¨ê»˜ ë„ì „í•´ë´!`;
      }

      if (navigator.share) {
        try {
          await navigator.share({ title: shareTitle, text: shareText });
          logEvent('share_success', { method: 'native' });
        } catch (err) {
          if (err.name !== 'AbortError') {
            fallbackShare(shareText);
          }
        }
      } else {
        fallbackShare(shareText);
      }
    });

    function fallbackShare(text) {
      if (navigator.clipboard?.writeText) {
        navigator.clipboard.writeText(text).then(() => {
          alert('ê³µìœ  ë¬¸êµ¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì¹´ì¹´ì˜¤í†¡ì´ë‚˜ ë¬¸ìë¡œ ê³µìœ í•´ë³´ì„¸ìš”.');
          logEvent('share_success', { method: 'clipboard' });
        });
      } else {
        alert(text);
      }
    }

    modeButtons.forEach((btn) => {
      btn.addEventListener('click', () => {
        const m = Number(btn.dataset.mode);
        targetSeconds = m;
        currentMode = m;
        
        // Update mode description
        modeDesc.textContent = `ì •í™•íˆ ${m}ì´ˆë¥¼ ë§ì¶°ë³´ì„¸ìš”`;

        modeButtons.forEach((b) => b.classList.remove('active'));
        btn.classList.add('active');

        setState(stateEnum.IDLE);
        updateBestUI();
        logEvent('mode_changed', { mode: m });
      });
    });

    // ============================================================
    // INITIALIZATION
    // ============================================================
    function init() {
      updateBestUI();
      setState(stateEnum.IDLE);
      logEvent('app_launch', { timestamp: new Date().toISOString() });
      logEvent('ad_impression', { type: 'banner' });

      document.addEventListener(
        'touchmove',
        (e) => {
          if (appState === stateEnum.RUNNING) e.preventDefault();
        },
        { passive: false }
      );

      window.addEventListener('resize', () => {
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;
      });
    }

    init();

    window.__gameState = { setState, stopAndEvaluate, loadBest, logEvent };
  </script>
</body>
</html>
